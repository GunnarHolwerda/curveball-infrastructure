version: '2'

services:
  curveball-db:
    image: postgres:10.4
    restart: always
    ports: 
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./backups:/var/log/pg_backups
      - ./schema:/var/log/pg_schema
      - './certs/:/etc/ssl/private/'
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: example
  curveball-quiz:
    image: curveball/quiz
    restart: always
    ports:
      - "3000:3000"
    volumes:
      - '../quiz/src/:/usr/local/src/quiz/src'
      - '../quiz/serverless.yml:/usr/local/src/quiz/serverless.yml'
      - './certs/:/etc/ssl/private/'
  curveball-cache:
    image: redis:4.0
    restart: always
    ports: 
      - "6379:6379"
  curveball-realtime:
    image: curveball/realtime
    restart: always
    ports:
      - "3001:3001"
    volumes:
      - '../realtime/src/:/usr/local/src/realtime/src'
      - '../realtime/index.ts:/usr/local/src/realtime/index.ts'
      - './certs/:/etc/ssl/private/'
  curveball-control:
    image: curveball/control
    restart: always
    ports:
      - "4200:4200"
    volumes:
      - '../curveball-control/src/:/usr/local/src/control/src'
      - './certs/:/usr/local/src/control/'


